// Generated by CoffeeScript 1.9.3
var isUrlValid;

$(document).ready(function() {
  $('#type').change(function() {
    if ($(this).val() === 'GET') {
      return $('#dataWrapper').addClass('hide');
    } else if ($(this).val() === 'POST') {
      return $('#dataWrapper').removeClass('hide');
    }
  });
  $('#newURLButton').click(function() {
    var data, jsonError, url;
    event.preventDefault();
    $('.urlAlert').addClass('hide');
    url = $('#url').val();
    if (!isUrlValid(url)) {
      $('#newURLErrorURL').removeClass('hide');
      return;
    }
    data = $('#data').val();
    if (data) {
      try {
        $.parseJSON(data);
      } catch (_error) {
        jsonError = _error;
        $('#newURLErrorData').removeClass('hide');
        return;
      }
    }
    return $.post('/add-url', $('#newURLForm').serialize()).done(function(newUrlId) {
      var actionCell, buttonGrouper, dataCell, deleteButton, row, type, typeCell, updateButton, urlCell;
      $('#newURLSuccess').removeClass('hide');
      urlCell = document.createElement('td');
      $(urlCell).append(url);
      typeCell = document.createElement('td');
      type = $('#type').val();
      $(typeCell).append(type);
      dataCell = document.createElement('td');
      data = $('#data').val();
      $(dataCell).append(data);
      actionCell = document.createElement('td');
      updateButton = document.createElement('button');
      $(updateButton).attr({
        'type': 'button',
        'data-url-id': newUrlId,
        'class': 'btn btn-default updateUrl'
      });
      $(updateButton).html('Update');
      deleteButton = document.createElement('button');
      $(deleteButton).attr({
        'type': 'button',
        'data-url-id': newUrlId,
        'class': 'btn btn-default deleteUrl'
      });
      $(deleteButton).html('Delete');
      buttonGrouper = document.createElement('div');
      $(buttonGrouper).attr({
        'class': 'btn-group',
        'role': 'group'
      });
      $(buttonGrouper).append(updateButton, deleteButton);
      $(actionCell).append(buttonGrouper);
      row = document.createElement('tr');
      $(row).append(urlCell, typeCell, dataCell, actionCell);
      return $('#urlTableBody').prepend(row);
    }).fail(function(requestError) {
      return $("#" + requestError['responseText']).removeClass('hide');
    });
  });
  $('body').delegate('.deleteUrl', 'click', function() {
    var _id, rowDom;
    $('.urlAlert').addClass('hide');
    _id = $(this).data('url-id');
    rowDom = $(this).closest('tr');
    return $.post('/delete-url', {
      _id: _id
    }).done(function() {
      return rowDom.remove();
    }).fail(function() {
      return $('#deleteUrlError').removeClass('hide');
    });
  });
  return $('.updateUrl').click(function() {
    return console.log($(this).data('url-id'));
  });
});

isUrlValid = function(url) {
  return /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url);
};
